<div class="user-profile">
  <div class="page-header">
    <h2>User Profile</h2>
    <p>View and manage user details</p>
  </div>

  <!-- New User Panel -->
  <div class="expandable-panel">
    <div class="panel-header" (click)="toggleNewUserPanel()">
      <h3>New user</h3>
      <button class="toggle-btn" type="button">
        <svg 
          class="toggle-icon" 
          [class.rotated]="isNewUserPanelExpanded"
          viewBox="0 0 24 24" 
          fill="currentColor"
        >
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
      </button>
    </div>
    <div class="panel-content" [class.expanded]="isNewUserPanelExpanded">
      <div class="branch-form-container">
        <form class="branch-form">
          <div class="form-row-three">
            <div class="form-group">
              <label for="username">Username</label>
              <input id="username" type="text" class="field-value" placeholder="Enter username" />
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input id="email" type="email" class="field-value" placeholder="Enter email" />
            </div>
            <div class="form-group" style="padding: 0;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div style="display: flex; flex-direction: column;">
                  <label for="password">Password</label>
                  <input id="password" type="password" class="field-value" placeholder="Enter password" />
                </div>
                <div style="display: flex; flex-direction: column;">
                  <label for="confirmPassword">Confirm Password</label>
                  <input id="confirmPassword" type="password" class="field-value" placeholder="Confirm password" />
                </div>
              </div>
            </div>
          </div>
          <div class="form-row-three">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input id="firstName" type="text" class="field-value" placeholder="Enter first name" />
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input id="lastName" type="text" class="field-value" placeholder="Enter last name" />
            </div>
            <div class="form-group">
              <label for="defaultCompany">Default Company</label>
              <select id="defaultCompany" class="field-value">
                <option value="">Select Company</option>
                <!-- Add company options dynamically -->
              </select>
            </div>
          </div>
          <div class="form-row-three">
            <div class="form-group">
              <label for="defaultBranch">Default Branch</label>
              <select id="defaultBranch" class="field-value">
                <option value="">Select Branch</option>
                <!-- Add branch options dynamically -->
              </select>
            </div>
            <div class="form-group">
              <label for="role">Role</label>
              <select id="role" class="field-value">
                <option value="">Select Role</option>
                <option value="admin">Admin</option>
                <option value="manager">Manager</option>
                <option value="user">User</option>
                <!-- Add more roles as needed -->
              </select>
            </div>
            <div class="form-group" style="display: flex; align-items: left; height: 100%;">
              <label for="isActive" class="checkbox-label" style="margin-top: 1.5rem;">
                <input
                  id="isActive"
                  type="checkbox"
                  class="checkbox-input"
                />
                <span class="checkbox-text">Active</span>
              </label>
            </div>
          </div>
          <div class="form-actions" style="margin-top: 1rem;">
            <button type="submit" class="submit-btn">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              Create User
            </button>
            <button type="reset" class="reset-btn">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
              </svg>
              Reset
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Users Panel -->
  <div class="expandable-panel">
    <div class="panel-header" (click)="toggleUsersPanel()">
      <h3>Users</h3>
      <button class="toggle-btn" type="button">
        <svg 
          class="toggle-icon" 
          [class.rotated]="isUsersPanelExpanded"
          viewBox="0 0 24 24" 
          fill="currentColor"
        >
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
      </button>
    </div>
    <div class="panel-content" [class.expanded]="isUsersPanelExpanded">
      <div class="actions-grid">
        <button class="action-btn" (click)="viewAllUsers()">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
          </svg>
          <span>View All Users</span>
        </button>
      </div>
      <div *ngIf="showUsersGrid">
        <div class="users-grid-container">
          <div class="grid-header">
            <h3>All Users</h3>
            <button class="close-btn" (click)="showUsersGrid = false">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
          <ng-container *ngIf="users.length > 0; else noUsers">
            <table class="users-table">
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>Username</th>
                  <th>Email</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Member Since</th>
                  <th>Status</th>
                  <th>Default Company</th>
                  <th>Default Branch</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users">
                  <td>{{ user.id }}</td>
                  <td>{{ user.username }}</td>
                  <td>{{ user.email }}</td>
                  <td>{{ user.firstName }}</td>
                  <td>{{ user.lastName }}</td>
                  <td>{{ user.createdAt | date:'medium' }}</td>
                  <td>{{ user.status }}</td>
                  <td>{{ user.defaultCompany }}</td>
                  <td>{{ user.defaultBranch }}</td>
                  <td>
                    <button class="edit-btn" (click)="editUser(user)">Edit</button>
                    <button class="delete-btn" (click)="deleteUser(user)">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-template #noUsers>
            <div class="no-data">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <p>No users found. Add your first user using the form above.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <div class="error-message" *ngIf="errorMessage">
    <svg class="error-icon" viewBox="0 0 24 24" fill="currentColor">
      <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
    </svg>
    <p>{{ errorMessage }}</p>
  </div>
</div>