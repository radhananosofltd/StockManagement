<div class="category-page">
  <div class="page-header">
    <h2>Category Management</h2>
    <p>Add and manage categories in your stock management system</p>
  </div>

  <!-- Add Category Panel -->
  <div class="expandable-panel">
    <div class="panel-header" (click)="toggleAddCategoryPanel()">
      <h3>Add Category</h3>
      <button class="toggle-btn" type="button">
        <svg 
          class="toggle-icon" 
          [class.rotated]="isAddCategoryPanelExpanded()"
          viewBox="0 0 24 24" 
          fill="currentColor"
        >
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
      </button>
    </div>

    <div class="panel-content" [class.expanded]="isAddCategoryPanelExpanded()">
      <div class="category-form-container">
        <form [formGroup]="categoryForm">
          <div *ngIf="message" class="category-message">
            {{ message }}
          </div>
          <!-- Category Name and Active Checkbox in same row -->
          <div class="form-row">
            <div class="form-row-col1">
              <div class="form-field category-name-field">
                <label for="categoryName">Category <span class="required">*</span></label>
                <input 
                  type="text" 
                  id="categoryName"
                  formControlName="categoryName"
                  placeholder="Enter category name"
                  [class.error]="categoryForm.get('categoryName')?.invalid && categoryForm.get('categoryName')?.touched"
                />
                @if (categoryForm.get('categoryName')?.invalid && categoryForm.get('categoryName')?.touched) {
                  <span class="error-message">Category name is required</span>
                }
              </div>
              <div class="form-field checkbox-field-inline">
                <label>
                  <input 
                    type="checkbox" 
                    formControlName="isActive" *ngIf="false"
                  />
                  <!-- <span>Active</span> -->
                </label>
              </div>
            </div>

          </div>

          <!-- Specifications Grid Display -->
          <div class="specifications-grid-container">

            @if (isLoadingSpecifications()) {
                <div class="loading-spinner">
                  <div class="spinner"></div>
                  <p>Loading specifications...</p>
                </div>
              } @else if (specifications().length === 0) {
                <div class="no-data">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                  <p>No specifications found.</p>
                </div>
              } @else {
                <div class="specifications-table">
                  <table>
                    <thead>
                      <tr>
                        <th style="width: 40px;"></th>
                        <th>Specification</th>
                        <th>Data Type</th>
                        <th>SKU</th>
                        <th>Editable</th>
                        <th>Configurable</th>
                        <th>Bulk Input</th>
                        <th>Lockable</th>
                        <th>Background</th>
                        <th>Required</th>
                        <th>SKU Order</th>
                      </tr>
                    </thead>
                    <tbody cdkDropList (cdkDropListDropped)="dropSpecificationRow($event)">
                      @for (spec of specifications(); track spec.specificationId) {
                        @if (spec.isActive) {
                          <tr cdkDrag>
                            <td class="drag-handle-cell">
                              <span cdkDragHandle class="drag-handle-icon" title="Drag to reorder">&#9776;</span>
                            </td>
                            <td class="spec-name">{{ spec.specificationName }}</td>
                            <td class="spec-datatype">{{ spec.datatype }}</td>
                            <td class="spec-boolean">
                              <span class="boolean-indicator" [class.active]="spec.sku">
                                {{ spec.sku ? '✓' : '✗' }}
                              </span>
                            </td>
                            <td class="spec-boolean">
                              <span class="boolean-indicator" [class.active]="spec.editable">
                                {{ spec.editable ? '✓' : '✗' }}
                              </span>
                            </td>
                            <td class="spec-boolean">
                              <span class="boolean-indicator" [class.active]="spec.configurable">
                                {{ spec.configurable ? '✓' : '✗' }}
                              </span>
                            </td>
                            <td class="spec-boolean">
                              <span class="boolean-indicator" [class.active]="spec.bulkInput">
                                {{ spec.bulkInput ? '✓' : '✗' }}
                              </span>
                            </td>
                            <td class="spec-boolean">
                              <span class="boolean-indicator" [class.active]="spec.lockable">
                                {{ spec.lockable ? '✓' : '✗' }}
                              </span>
                            </td>
                            <td class="spec-boolean">
                              <span class="boolean-indicator" [class.active]="spec.background">
                                {{ spec.background ? '✓' : '✗' }}
                              </span>
                            </td>
                            <td class="spec-action">
                              <input type="checkbox" [checked]="false" [id]="spec.specificationId" />
                            </td>
                            <td class="spec-sku-order">
                              <select class="sku-order-dropdown" [ngModel]="spec.skuOrder" (ngModelChange)="onSkuOrderChange($event, spec)" [ngModelOptions]="{standalone: true}" [id]="'sku-order-' + spec.specificationId">
                                <option value=""></option>
                                <option *ngFor="let order of getAvailableSkuOrders(spec)" [value]="order">{{ order }}</option>
                              </select>
                            </td>
                          </tr>
                        }
                      }
                    </tbody>
                  </table>
                </div>
              }
          </div>

                      <div class="form-row-col2">
              <div class="form-actions">
                <button 
                  type="button" 
                  class="submit-btn" 
                  (click)="addCategory()"
                  [disabled]="isSubmitting()"
                >
                  @if (isSubmitting()) {
                    <span class="spinner"></span>
                    <span>Adding...</span>
                  } @else {
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    <span>Save</span>
                  }
                </button>
                <button 
                  type="button" 
                  class="reset-btn" 
                  (click)="resetForm()"
                  [disabled]="isSubmitting()"
                >
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
                  </svg>
                  <span>Reset</span>
                </button>
              </div>
            </div>
          <!-- Form Action Buttons removed from here -->
        </form>
      </div>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="expandable-panel">
    <div class="panel-header" (click)="toggleQuickActionsPanel()">
      <h3>Quick Actions</h3>
      <button class="toggle-btn" type="button">
        <svg 
          class="toggle-icon" 
          [class.rotated]="isQuickActionsPanelExpanded()"
          viewBox="0 0 24 24" 
          fill="currentColor"
        >
          <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
      </button>
    </div>

    <div class="panel-content" [class.expanded]="isQuickActionsPanelExpanded()">
      <div class="categories-management-content">
        <!-- Quick Actions Card -->
        <div class="quick-actions-card">
    <div class="actions-grid">
      <button class="action-btn" (click)="viewAllCategories()">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
        </svg>
        <span>View All Categories</span>
      </button>
      <button class="action-btn" (click)="importCategories()" [disabled]="isImporting()">
        @if (isImporting()) {
          <span class="spinner"></span>
          <span>Importing...</span>
        } @else {
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
          </svg>
          <span>Import Categories</span>
        }
      </button>
      <button class="action-btn" (click)="exportCategories()" [disabled]="isExporting()">
        @if (isExporting()) {
          <span class="spinner"></span>
          <span>Exporting...</span>
        } @else {
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 10h6v6h4l-7 7-7-7h4zm-4-4h14v2H5z"/>
          </svg>
          <span>Export Categories</span>
        }
      </button>
    </div>
  </div>

  <!-- Categories Grid Display -->
  @if (showAllCategoriesPanel()) {
    <div class="categories-grid-container" id="categories-grid" #categoriesGrid>
      <div class="grid-header">
        <h3>All Categories</h3>
        <button class="close-btn" (click)="hideCategoriesGrid()">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>

      @if (isLoadingCategories()) {
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Loading categories...</p>
        </div>
      } @else if (categories().length === 0) {
        <div class="no-data">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <p>No categories found. Add your first category using the form above.</p>
        </div>
      } @else {
        <div class="categories-table">
          <table>
            <thead>
              <tr>
                <th>Category</th>
                <th>Status</th>
                <th>Created Date</th>
                <th>SKUFields</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              @for (cat of pagedCategories; track cat.category) {
                <tr>
                  <td class="category-name">{{ cat.category }}</td>
                  <td class="category-status">
                    <span class="status-badge" [class.active]="cat.status === 'Active'">
                      {{ cat.status }}
                    </span>
                  </td>
                  <td class="category-date">{{ cat.createdDate | date:'short' }}</td>
                  <td class="category-skuFields">{{ cat.skuFields }}</td>
                  <td class="category-actions">
                    <button class="action-btn edit-btn" (click)="editCategory(cat)">Edit</button>
                    <button class="action-btn delete-btn" (click)="deleteCategory(cat)">Delete</button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
          <div class="pagination-controls" *ngIf="totalCategoryPages > 1">
            <button class="pagination-btn" [disabled]="currentCategoryPage() === 1" (click)="setCategoryPage(currentCategoryPage() - 1)">Prev</button>
            <span>Page {{ currentCategoryPage() }} of {{ totalCategoryPages }}</span>
            <button class="pagination-btn" [disabled]="currentCategoryPage() === totalCategoryPages" (click)="setCategoryPage(currentCategoryPage() + 1)">Next</button>
          </div>
        </div>
      }
    </div>
  }
      </div>
    </div>
  </div>
</div>